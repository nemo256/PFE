\section{Introduction}
\vspace{0.2in}
\hspace*{0.16in}
%TODO explain what we tested with steps For this chapter, we will present the tools we used and our results of segmenting and counting blood cells (red, white, platelets).

\section{Used Tools}
\subsection{TensorFlow}
In our work we used TensorFlow which is an open source library developed by Google Brain Team for Artificial Intelligence, it contains multiple pre-defined models and algorithms for Deep Learning and Machine Learning, tensorFlow can be used in multiple languages as python, C++, Java and JavaScript.\\
Tensorflow can be used to Create, Train, Deploy Models. And when we talk about complicated models we can use Keras.
Keras is a high level API for Neural Networks which helps with experiments on the models and extensibility.

\begin{figure}[H]
    \centering
      \vspace{-0.1in}
        \centerline{\includegraphics[width = 3in]{../images/tensorflow.png}}
        \caption{Tensorflow}
        \label{Tensorflow}
    \end{figure}

\subsection{Colab}
Google Colab or Colaboratory is a free Jupyter notebook environment running on Google's cloud servers for machine learning training and research. This platform allows the user to leverage backend hardware such as GPUs and TPUs and train Machine Learning and Deep Learning models directly in the cloud. Without the need to install anything on our computer at the anything on our computer except a browser.
but it has some disadvantages where we have a limit on the GPU usage
and non presistant storage.

\begin{figure}[H]
\centering
  \vspace{-0.1in}
    \centerline{\includegraphics[width = 2in]{../images/colab.png}}
    \caption{Google Colab}
    \label{Google Colab}
\end{figure}

\subsection{PaperSpace}
Paperspace is a high-performance cloud computing and ML development platform for building, training and deploying machine learning models. It has a complete jupyter notebook environement which has a persistent storage and 6 hours limit for each execution.

\begin{figure}[H]
    \centering
      \vspace{-0.1in}
        \centerline{\includegraphics[width = 3in]{../images/paperspace.png}}
        \caption{Paperspace}
        \label{Paperspace}
    \end{figure}

\section{Experiments and Results}
In this Section we will detail the different experiments and we will discuss the evaluation results obtained from the two segmentation models DO-UNet and DO-SegNet both with the BinaryCrossEnropy Loss Function. And we also discuss the evaluation results of the three counting algorithms Watershed, Circle Hough Transform and Connected Component Labeling for the three blood elements RBCs and WBCs and Platelets.

\subsection{Red Blood Cells}
The Red Blood Cells are the most difficult to detect because of the overlapping, where in some samples we can't notice the overlapping by eyes, in this experiment we are comparing DO-U-Net from \textsuperscript{\cite{10.1007/978-3-030-44584-3_31}} and the SegNet model.
In the DO-UNet we updated the data augmentation phase. and applied transfer Learning to get better edge mask. we can see in the dataset that we have only 13 images of 108 that contains edge and 108 masks, so the problem here is the lack of the edge label. we ended up with the method below as the best fit to our problem:
\begin{enumerate}
    \item Train the DO-Unet outputs on the big dataset (108 maks) which will output two identical masks.
    \item Continue Training the DO-Unet with the small dataset (13 masks, 13 edges), and Freeze the Mask Output
\end{enumerate}

\input{tables/DO-UNet-Training.tex}

The table \ref{table:do-unet-transfer} compares between the normal trained model A on the small dataset which contains 13 masks and edges and the model be which is trained on two phases, first with the big dataset (108 mask without edge) for 60 epochs, in the second phase we continued training with the small dataset (13 masks + edges) for 400 epochs.
We can see that this method pushed the edge accuracy which is really important to get rid of the overlapping.

In the SegNet ... %TODOAMINE

\subsubsection{DO-U-Net}
After training the model we did a benchmark on the 13 images to calculate the counting accuracy of the three methods, we ended up with the table below where we can see that the Circle hough transform method is the best for RBC counting with 95.36 accuracy, because all the RBCs have a similar shape and size.

\input{tables/RBC_DOUNET.tex}


\subsubsection{DO-SegNet}
%TODO we will do the same thing as DO-UNET and at the end we draw a resume table wich will compare between both/ or we can do both in the same table 
\input{tables/rbc_segnet.tex}

\subsection{White Blood Cells}
The White Blood Cells are also difficult to detect because of the non stable shape and in some cases they overlap, in this experiment we are comparing single output U-Net from \textsuperscript{\cite{10.1007/978-3-030-44584-3_31}} and the single output SegNet model.
In the UNet we removed the edge output because we don't have the edge annotation. then trained the model for 15 epochs with the binaryCrossEntropy Loss function on (74 + 34) images.

\subsubsection{DO-U-Net}

\input{tables/WBC_DOUNET.tex}

\subsubsection{DO-SegNet}

% \input{tables/wbc_segnet}

\subsection{Platlets}
%TODO Same
\subsubsection{DO-U-Net}
\subsubsection{DO-SegNet}

% \input{tables/plt_segnet}

%TODO at the end we draw some tables that will contain the 3 

\section{Results}
\vspace{0.2in}
\hspace*{0.16in}

\input{tables/table7.tex}

